<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Auditor√≠as - Plataforma Textil OIT</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="feedback.css">
  <style>
    .auditoria-card {
      padding: 1rem;
      border: 2px solid var(--slate-200);
      border-radius: 0.75rem;
      margin-bottom: 0.75rem;
    }
    .auditoria-card.programada {
      border-left: 4px solid var(--sky-600);
      background: var(--sky-50);
    }
    .auditoria-card.realizada {
      border-left: 4px solid var(--slate-400);
    }
    .auditoria-card.observado {
      border-left: 4px solid var(--amber-600);
      background: var(--amber-50);
    }
    .auditoria-card.aprobado {
      border-left: 4px solid var(--emerald-600);
      background: var(--emerald-50);
    }
    .accion-correctiva {
      padding: 0.75rem;
      background: white;
      border: 1px solid var(--slate-200);
      border-radius: 0.5rem;
      margin-bottom: 0.5rem;
    }
    .accion-correctiva.completada {
      background: var(--emerald-50);
      border-color: var(--emerald-300);
    }
  </style>
</head>
<body>

  <!--
    PANTALLA: auditorias.html (Auditor√≠as y Planes Correctivos)
    BARRERAS: B5 (Estado Ausente)
    FUNCIONES: FISCALIZAR (auditor√≠as y seguimiento)
    ACTORES: Estado (STESS, ARCA), Taller
    DESCRIPCI√ìN: Registro de auditor√≠as programadas/realizadas y planes de acci√≥n correctiva.
  -->

  <!-- Topbar -->
  <header class="topbar">
    <div class="topbar-content">
      <div class="topbar-logo">
        <div class="logo-icon">PT</div>
        <div>
          <div class="text-sm font-semibold text-slate-900">Plataforma Textil</div>
          <div class="text-xs text-slate-500" id="topbarSubtitle">Inspector: #INS-045</div>
        </div>
      </div>

      <nav class="topbar-nav">
        <button class="nav-tab" onclick="window.location.href='dashboard-tripartito.html'">Dashboard</button>
        <button class="nav-tab" onclick="window.location.href='denuncias.html'">Denuncias</button>
        <button class="nav-tab active" onclick="window.location.href='auditorias.html'">Auditor√≠as</button>
        <button class="nav-tab" onclick="alert('Informes')">Informes</button>
      </nav>

      <div class="flex items-center gap-3">
        <button class="btn btn-secondary btn-sm" onclick="cambiarVista()">
          Cambiar vista: <span id="vistaActual">Inspector</span>
        </button>
        <span class="pill pill-sky">v1.3 Barreras</span>
        <button class="btn btn-secondary" onclick="if(confirm('¬øCerrar sesi√≥n?')) window.location.href='index.html'">Salir</button>
      </div>
    </div>
  </header>

  <!-- Main content -->
  <main class="main-content">
    <div class="page-header">
      <div>
        <h1 class="page-title" id="pageTitle">Panel de Auditor√≠as</h1>
        <p class="page-subtitle">Programaci√≥n, realizaci√≥n y seguimiento de auditor√≠as laborales</p>
      </div>
      <button class="btn btn-primary" onclick="programarAuditoria()">
        + Programar Auditor√≠a
      </button>
    </div>

    <!-- Alerta -->
    <div class="alert alert-info mb-6">
      <strong>üìã Wireframe v1.3:</strong> Esta pantalla demuestra c√≥mo se resuelve <strong>B5 (Estado Ausente)</strong> con auditor√≠as proactivas. Tiene 2 vistas: <strong>Inspector/Estado</strong> (programa y asigna) y <strong>Taller</strong> (ve sus auditor√≠as y planes correctivos).
    </div>

    <!-- Vista Inspector -->
    <div id="vistaInspector">
      <div class="grid grid-cols-12 gap-6">
        <!-- Columna principal -->
        <div class="col-span-8 space-y-6">
          <!-- Auditor√≠as programadas -->
          <div class="section-card">
            <div class="section-header mb-4">
              <div>
                <h3 class="section-title">Auditor√≠as Programadas</h3>
                <p class="section-subtitle">Pr√≥ximas inspecciones asignadas</p>
              </div>
            </div>

            <div class="space-y-3">
              <!-- Auditor√≠a 1: Pr√≥xima -->
              <div class="auditoria-card programada">
                <div class="flex items-center justify-between mb-2">
                  <div>
                    <div class="font-bold text-sky-900">Taller: Textil Roca SRL</div>
                    <div class="text-sm text-sky-700">CUIT: 30-11223344-5 | Mor√≥n, BA</div>
                  </div>
                  <span class="badge badge-sky">Programada</span>
                </div>
                <div class="grid grid-cols-3 gap-4 text-sm mt-3">
                  <div>
                    <div class="text-slate-600">Fecha:</div>
                    <div class="font-semibold">05/11/2025 - 10:00 hs</div>
                  </div>
                  <div>
                    <div class="text-slate-600">Tipo:</div>
                    <div class="font-semibold">Seguridad e Higiene</div>
                  </div>
                  <div>
                    <div class="text-slate-600">Origen:</div>
                    <div class="font-semibold">Certificaci√≥n INTI</div>
                  </div>
                </div>
                <div class="mt-3 p-2 bg-white rounded border border-sky-300 text-sm">
                  <strong>Documentaci√≥n requerida:</strong> Habilitaci√≥n municipal, protocolo COVID, registro de capacitaciones SST
                </div>
                <div class="flex gap-2 mt-3">
                  <button class="btn btn-primary btn-sm" onclick="realizarAuditoria('textil-roca')">
                    ‚úì Realizar Auditor√≠a
                  </button>
                  <button class="btn btn-secondary btn-sm" onclick="alert('Descargar checklist de seguridad e higiene (PDF)')">
                    üì• Checklist
                  </button>
                  <button class="btn btn-secondary btn-sm" onclick="reprogramarAuditoria('textil-roca')">
                    üìÖ Reprogramar
                  </button>
                </div>
              </div>

              <!-- Auditor√≠a 2: Denuncia -->
              <div class="auditoria-card programada">
                <div class="flex items-center justify-between mb-2">
                  <div>
                    <div class="font-bold text-sky-900">Taller: Confecciones del Sur</div>
                    <div class="text-sm text-sky-700">CUIT: 30-55667788-9 | Avellaneda, BA</div>
                  </div>
                  <span class="badge badge-rose">Urgente - Denuncia</span>
                </div>
                <div class="grid grid-cols-3 gap-4 text-sm mt-3">
                  <div>
                    <div class="text-slate-600">Fecha:</div>
                    <div class="font-semibold">02/11/2025 - 14:00 hs</div>
                  </div>
                  <div>
                    <div class="text-slate-600">Tipo:</div>
                    <div class="font-semibold">Investigaci√≥n denuncia</div>
                  </div>
                  <div>
                    <div class="text-slate-600">C√≥digo denuncia:</div>
                    <div class="font-semibold">#D2025-0234</div>
                  </div>
                </div>
                <div class="mt-3 p-2 bg-rose-50 rounded border border-rose-300 text-sm">
                  <strong>Motivo:</strong> Denuncia por incumplimiento de contrato (plazos y calidad). Verificar condiciones laborales y cumplimiento normativo.
                </div>
                <div class="flex gap-2 mt-3">
                  <button class="btn btn-primary btn-sm" onclick="realizarAuditoria('confecciones-sur')">
                    ‚úì Realizar Auditor√≠a
                  </button>
                  <button class="btn btn-secondary btn-sm" onclick="verDenuncia('D2025-0234')">
                    üëÅ Ver Denuncia
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Auditor√≠as realizadas -->
          <div class="section-card">
            <div class="section-header mb-4">
              <div>
                <h3 class="section-title">Auditor√≠as Realizadas Recientemente</h3>
                <p class="section-subtitle">√öltimas inspecciones completadas</p>
              </div>
            </div>

            <div class="space-y-3">
              <!-- Auditor√≠a realizada 1: Observado -->
              <div class="auditoria-card observado">
                <div class="flex items-center justify-between mb-2">
                  <div>
                    <div class="font-bold text-amber-900">Taller: Corte y Confecci√≥n SA</div>
                    <div class="text-sm text-amber-700">CUIT: 30-99887766-3 | La Matanza, BA</div>
                  </div>
                  <span class="badge badge-amber">Observado</span>
                </div>
                <div class="grid grid-cols-3 gap-4 text-sm mt-3">
                  <div>
                    <div class="text-slate-600">Fecha realizaci√≥n:</div>
                    <div class="font-semibold">15/09/2025</div>
                  </div>
                  <div>
                    <div class="text-slate-600">Tipo:</div>
                    <div class="font-semibold">Seguridad e Higiene</div>
                  </div>
                  <div>
                    <div class="text-slate-600">Inspector:</div>
                    <div class="font-semibold">#INS-045</div>
                  </div>
                </div>
                <div class="mt-3 p-2 bg-white rounded border border-amber-400 text-sm">
                  <strong>Observaciones:</strong> Falta matafuegos (2 unidades), salida de emergencia sin se√±alizar, ventilaci√≥n insuficiente
                </div>
                <div class="mt-2 p-2 bg-amber-100 rounded text-sm">
                  <strong>Plan correctivo:</strong> En progreso (60%) - Plazo: 15/11/2025 - <button class="text-sky-700 underline" onclick="verPlanCorrectivo('corte-confeccion')">Ver detalle ‚Üí</button>
                </div>
              </div>

              <!-- Auditor√≠a realizada 2: Aprobado -->
              <div class="auditoria-card aprobado">
                <div class="flex items-center justify-between mb-2">
                  <div>
                    <div class="font-bold text-emerald-900">Taller: Cooperativa El Telar</div>
                    <div class="text-sm text-emerald-700">CUIT: 30-12312312-4 | Flores, CABA</div>
                  </div>
                  <span class="badge badge-emerald">Aprobado</span>
                </div>
                <div class="grid grid-cols-3 gap-4 text-sm mt-3">
                  <div>
                    <div class="text-slate-600">Fecha realizaci√≥n:</div>
                    <div class="font-semibold">10/09/2025</div>
                  </div>
                  <div>
                    <div class="text-slate-600">Tipo:</div>
                    <div class="font-semibold">Laboral general</div>
                  </div>
                  <div>
                    <div class="text-slate-600">Inspector:</div>
                    <div class="font-semibold">#INS-022</div>
                  </div>
                </div>
                <div class="mt-3 p-2 bg-white rounded border border-emerald-400 text-sm">
                  <strong>Resultado:</strong> Cumple con todas las normativas laborales, de seguridad e higiene. Instalaciones en condiciones √≥ptimas.
                </div>
                <button class="btn btn-secondary btn-sm mt-2" onclick="verInformeFinal('el-telar')">
                  üìÑ Ver informe completo
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Sidebar Inspector -->
        <div class="col-span-4 space-y-6">
          <!-- M√©tricas -->
          <div class="section-card">
            <h3 class="section-title mb-4">Mis M√©tricas</h3>

            <div class="grid grid-cols-2 gap-3 text-sm">
              <div class="p-3 bg-sky-50 rounded text-center">
                <div class="text-2xl font-bold text-sky-700">5</div>
                <div class="text-xs text-sky-600">Programadas</div>
              </div>
              <div class="p-3 bg-emerald-50 rounded text-center">
                <div class="text-2xl font-bold text-emerald-700">12</div>
                <div class="text-xs text-emerald-600">Realizadas (mes)</div>
              </div>
            </div>

            <div class="mt-4 space-y-2 text-sm">
              <div class="flex justify-between">
                <span class="text-slate-600">Tasa aprobaci√≥n:</span>
                <span class="font-bold text-emerald-700">58%</span>
              </div>
              <div class="flex justify-between">
                <span class="text-slate-600">Con observaciones:</span>
                <span class="font-bold text-amber-700">33%</span>
              </div>
              <div class="flex justify-between">
                <span class="text-slate-600">Clausuras:</span>
                <span class="font-bold text-rose-700">1 (8%)</span>
              </div>
            </div>
          </div>

          <!-- Acciones r√°pidas -->
          <div class="section-card">
            <h3 class="section-title mb-3">Acciones R√°pidas</h3>

            <button class="btn btn-primary btn-block mb-2" onclick="programarAuditoria()">
              + Programar Auditor√≠a
            </button>

            <button class="btn btn-secondary btn-block mb-2" onclick="alert('Ver talleres prioritarios para auditar')">
              üéØ Talleres Prioritarios
            </button>

            <button class="btn btn-secondary btn-block" onclick="window.location.href='denuncias.html'">
              üìã Ver Denuncias Pendientes
            </button>
          </div>

          <!-- Priorizaci√≥n -->
          <div class="section-card">
            <h3 class="section-title mb-3">Talleres Priorizados</h3>

            <div class="text-sm space-y-2">
              <div class="p-2 border-l-4 border-rose-600 bg-rose-50 rounded">
                <div class="font-semibold">3 talleres</div>
                <div class="text-xs">Con denuncias activas</div>
              </div>
              <div class="p-2 border-l-4 border-amber-600 bg-amber-50 rounded">
                <div class="font-semibold">7 talleres</div>
                <div class="text-xs">Sin auditar >12 meses</div>
              </div>
              <div class="p-2 border-l-4 border-sky-600 bg-sky-50 rounded">
                <div class="font-semibold">5 talleres</div>
                <div class="text-xs">Plan correctivo en curso</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Vista Taller (oculta por defecto) -->
    <div id="vistaTaller" style="display: none;">
      <div class="grid grid-cols-12 gap-6">
        <div class="col-span-8 space-y-6">
          <!-- Pr√≥xima auditor√≠a -->
          <div class="section-card">
            <div class="section-header mb-4">
              <div>
                <h3 class="section-title">Mi Pr√≥xima Auditor√≠a</h3>
                <p class="section-subtitle">Preparate para la inspecci√≥n</p>
              </div>
            </div>

            <div class="auditoria-card programada">
              <div class="font-bold text-sky-900 mb-2">Auditor√≠a de Seguridad e Higiene</div>
              <div class="grid grid-cols-2 gap-4 mb-3">
                <div>
                  <div class="text-sm text-slate-600">Fecha programada:</div>
                  <div class="text-lg font-bold text-sky-700">05/11/2025 - 10:00 hs</div>
                </div>
                <div>
                  <div class="text-sm text-slate-600">Inspector asignado:</div>
                  <div class="font-semibold">#INS-045</div>
                </div>
              </div>

              <div class="p-3 bg-white rounded border border-sky-300 mb-3">
                <div class="font-semibold mb-2">Documentaci√≥n que deber√°s presentar:</div>
                <ul class="text-sm space-y-1 ml-4" style="list-style: disc;">
                  <li>Habilitaci√≥n municipal vigente</li>
                  <li>Protocolo COVID actualizado</li>
                  <li>Registro de capacitaciones en SST</li>
                  <li>Certificados de matafuegos</li>
                  <li>Constancia de ART</li>
                </ul>
              </div>

              <div class="flex gap-2">
                <button class="btn btn-secondary btn-sm" onclick="alert('Descargar checklist de preparaci√≥n (PDF)')">
                  üì• Descargar Checklist
                </button>
                <button class="btn btn-secondary btn-sm" onclick="solicitarReprogramacion()">
                  üìÖ Solicitar Reprogramaci√≥n
                </button>
              </div>
            </div>
          </div>

          <!-- Plan correctivo activo -->
          <div class="section-card">
            <div class="section-header mb-4">
              <div>
                <h3 class="section-title">Plan de Acci√≥n Correctiva</h3>
                <p class="section-subtitle">Resultado de auditor√≠a del 15/09/2025</p>
              </div>
            </div>

            <div class="mb-4">
              <div class="flex justify-between text-sm mb-1">
                <span>Progreso:</span>
                <span class="font-bold text-amber-700">1/3 completadas (60%)</span>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" style="width: 60%; background: var(--amber-600);"></div>
              </div>
              <div class="text-sm text-amber-700 mt-1">
                <strong>Plazo l√≠mite:</strong> 15/11/2025 (15 d√≠as restantes)
              </div>
            </div>

            <div class="space-y-2">
              <div class="accion-correctiva">
                <div class="flex items-center gap-2 mb-1">
                  <span class="text-slate-400">‚óã</span>
                  <div class="flex-1 font-semibold text-slate-900">Instalar 2 matafuegos ABC</div>
                  <span class="text-xs text-slate-600">Plazo: 30 d√≠as</span>
                </div>
                <div class="text-sm text-slate-700">Ubicaci√≥n: Entrada principal + Sector de m√°quinas</div>
                <button class="btn btn-primary btn-sm mt-2" onclick="subirEvidencia('matafuegos')">
                  üì§ Subir evidencia de correcci√≥n
                </button>
              </div>

              <div class="accion-correctiva">
                <div class="flex items-center gap-2 mb-1">
                  <span class="text-slate-400">‚óã</span>
                  <div class="flex-1 font-semibold text-slate-900">Se√±alizar salida de emergencia</div>
                  <span class="text-xs text-slate-600">Plazo: 15 d√≠as</span>
                </div>
                <div class="text-sm text-slate-700">Cartel luminoso seg√∫n normativa vigente</div>
                <button class="btn btn-primary btn-sm mt-2" onclick="subirEvidencia('senalizacion')">
                  üì§ Subir evidencia de correcci√≥n
                </button>
              </div>

              <div class="accion-correctiva completada">
                <div class="flex items-center gap-2 mb-1">
                  <span class="text-emerald-700">‚úì</span>
                  <div class="flex-1 font-semibold text-emerald-900">Actualizar botiqu√≠n</div>
                  <span class="badge badge-emerald">Completado</span>
                </div>
                <div class="text-sm text-emerald-700">Verificado el 20/10/2025 - Evidencia aprobada</div>
              </div>
            </div>

            <div class="mt-4 p-3 bg-amber-50 border border-amber-300 rounded-xl text-sm">
              <strong>‚ö† Importante:</strong> Si no complet√°s el plan antes del 15/11/2025, habr√° suspensi√≥n temporal de actividad hasta regularizaci√≥n.
            </div>
          </div>
        </div>

        <!-- Sidebar Taller -->
        <div class="col-span-4 space-y-6">
          <!-- Historial -->
          <div class="section-card">
            <h3 class="section-title mb-3">Mi Historial</h3>

            <div class="space-y-3 text-sm">
              <div class="p-3 bg-emerald-50 rounded">
                <div class="font-semibold text-emerald-900">√öltima auditor√≠a aprobada</div>
                <div class="text-emerald-700">15/08/2024 - Laboral general</div>
              </div>

              <div class="p-3 bg-amber-50 rounded">
                <div class="font-semibold text-amber-900">Auditor√≠as con observaciones</div>
                <div class="text-amber-700">1 de 3 (33.3%)</div>
              </div>

              <div class="p-3 bg-sky-50 rounded">
                <div class="font-semibold text-sky-900">Planes correctivos</div>
                <div class="text-sky-700">1 activo, 0 vencidos</div>
              </div>
            </div>
          </div>

          <!-- Ayuda -->
          <div class="section-card">
            <h3 class="section-title mb-3">Ayuda y Soporte</h3>

            <button class="btn btn-secondary btn-block mb-2" onclick="alert('Solicitar extensi√≥n de plazo para plan correctivo')">
              ‚è± Solicitar Extensi√≥n
            </button>

            <button class="btn btn-secondary btn-block mb-2" onclick="alert('Contacto con INTI para asesoramiento')">
              üè¢ Asesoramiento INTI
            </button>

            <button class="btn btn-secondary btn-block" onclick="window.location.href='capacitaciones.html?tema=seguridad'">
              üéì Capacitaciones SST
            </button>
          </div>
        </div>
      </div>
    </div>

  </main>

  <script src="data.js"></script>
  <script src="script.js"></script>
  <script src="feedback.js"></script>
  <script src="navigation-controller.js"></script>
  <script src="pantalla-info.js"></script>
  <script>
    let vistaActual = 'inspector'; // o 'taller'

    function cambiarVista() {
      vistaActual = vistaActual === 'inspector' ? 'taller' : 'inspector';

      if (vistaActual === 'inspector') {
        document.getElementById('vistaInspector').style.display = 'block';
        document.getElementById('vistaTaller').style.display = 'none';
        document.getElementById('vistaActual').textContent = 'Inspector';
        document.getElementById('topbarSubtitle').textContent = 'Inspector: #INS-045';
        document.getElementById('pageTitle').textContent = 'Panel de Auditor√≠as';
      } else {
        document.getElementById('vistaInspector').style.display = 'none';
        document.getElementById('vistaTaller').style.display = 'block';
        document.getElementById('vistaActual').textContent = 'Taller';
        document.getElementById('topbarSubtitle').textContent = 'Taller: Corte Sur SRL';
        document.getElementById('pageTitle').textContent = 'Mis Auditor√≠as';
      }
    }

    function programarAuditoria() {
      alert('FUNCIONALIDAD WIREFRAME:\n\nAbrir√≠a formulario para programar auditor√≠a:\n\n- Seleccionar taller (b√∫squeda por CUIT/nombre)\n- Tipo de auditor√≠a (Laboral, Seguridad, Higiene, etc.)\n- Fecha y hora\n- Asignar inspector\n- Motivo (rutina, denuncia, seguimiento)\n- Documentaci√≥n requerida');
    }

    function realizarAuditoria(taller) {
      alert(`FUNCIONALIDAD WIREFRAME:\n\nAbrir√≠a interfaz de realizaci√≥n de auditor√≠a para: ${taller}\n\nIncluye:\n- Checklist digital de verificaci√≥n\n- Carga de observaciones\n- Captura de fotos/evidencia\n- Calificaci√≥n (Aprobado/Observado/Clausurado)\n- Generaci√≥n autom√°tica de acta\n- Si observado: carga de plan correctivo`);
    }

    function reprogramarAuditoria(taller) {
      if (confirm(`¬øReprogramar auditor√≠a de ${taller}?\n\nMotivos v√°lidos:\n- Caso fortuito\n- Solicitud justificada del taller\n- Reasignaci√≥n de inspector`)) {
        showToast('Auditor√≠a reprogramada para 10/11/2025', 'success');
      }
    }

    function verPlanCorrectivo(taller) {
      alert('FUNCIONALIDAD WIREFRAME:\n\nMostrar√≠a plan correctivo completo con:\n- Lista de acciones requeridas\n- Plazos por acci√≥n\n- Evidencia subida por el taller\n- Estado de aprobaci√≥n de cada √≠tem\n- Opciones para aprobar/rechazar correcciones');
    }

    function verInformeFinal(taller) {
      alert(`FUNCIONALIDAD WIREFRAME:\n\nGenerar√≠a PDF con informe completo de auditor√≠a de ${taller}:\n\n- Fecha y hora\n- Inspector\n- Checklist completo\n- Observaciones\n- Fotos/evidencia\n- Resultado final\n- Firma digital inspector`);
    }

    function verDenuncia(codigo) {
      window.location.href = `denuncias.html?codigo=${codigo}`;
    }

    function solicitarReprogramacion() {
      if (confirm('¬øSolicitar reprogramaci√≥n de auditor√≠a?\n\nDeber√°s justificar el motivo. La solicitud ser√° evaluada por STESS.')) {
        showToast('Solicitud enviada. Recibir√°s respuesta en 48-72 hs.', 'success');
      }
    }

    function subirEvidencia(tipo) {
      alert(`FUNCIONALIDAD WIREFRAME:\n\nAbrir√≠a di√°logo para subir evidencia de correcci√≥n: ${tipo}\n\n- Permitir seleccionar fotos/PDF\n- Agregar comentarios\n- Enviar a inspector para validaci√≥n\n- El inspector tiene 3-5 d√≠as para revisar`);
      showToast('Evidencia subida. El inspector la revisar√° en 3-5 d√≠as.', 'success');
    }
  </script>

</body>
</html>
